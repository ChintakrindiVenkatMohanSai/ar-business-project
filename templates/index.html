<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">

<script type="module"
src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js">
</script>

<link rel="stylesheet" href="/static/style.css">

<title>AR Product Viewer</title>
</head>

<body>

<h1>ðŸ“± AR Product Viewer</h1>

<a href="/admin">Upload Product</a>

{% for p in products %}
<div class="product">

<h2>{{p[1]}}</h2>

{% if p[3]=='model' %}
<!-- 3D AR -->
<model-viewer
src="/uploads/{{p[2]}}"
ar
camera-controls
auto-rotate>

<button slot="ar-button">
View 3D AR ðŸš€
</button>

</model-viewer>

{% else %}
<!-- IMAGE AR CAMERA -->
<button onclick="startImageAR('/uploads/{{p[2]}}')">
Start Image AR ðŸ“·
</button>
{% endif %}

</div>
{% endfor %}

<script>
async function startImageAR(img){

const stream = await navigator.mediaDevices.getUserMedia({
    video:{ facingMode:"environment" }
});

let video=document.createElement("video");
video.srcObject=stream;
video.autoplay=true;
video.style.position="fixed";
video.style.top="0";
video.style.left="0";
video.style.width="100%";
video.style.height="100%";
video.style.objectFit="cover";
document.body.appendChild(video);

let overlay=document.createElement("img");
overlay.src=img;
overlay.style.position="fixed";
overlay.style.width="300px";
overlay.style.bottom="50px";
overlay.style.left="50%";
overlay.style.transform="translateX(-50%)";
overlay.style.zIndex="999";
document.body.appendChild(overlay);

}
</script>
</body>
</html>
